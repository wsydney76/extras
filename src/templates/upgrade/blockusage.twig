{% set fields = craft.app.fields.allFields | filter(f => className(f) == 'craft\\fields\\Matrix') %}


{# @var field \craft\fields\Matrix #}
<table>
    {% for field in fields %}

        {% set types = field.entryTypes %}

        {# {% set types = types|filter(t => t.handle == 'markdown') %} #}

        {% for type in types %}
            <tr>
                <td>{{ field.name }}</td>

                <td>{{ type.name }}</td>

                <td>
                    {% set entries = craft.entries.site('*').status(null).fieldId(field.id).unique().type(type).all %}

                    {{ entries|length }}

                    {% if entries|length == 0 %}
                        <span style="color: red;">Unused</span>
                    {% endif %}

                </td>
                <td>
                    {% if entries|length < 3 %}
                        {% for entry in entries %}
                            <div>
                                {% set owner = craft.entries.id(entry.ownerId).site('*').status(null).unique().one %}
                                {% if owner %}
                                    <a href="{{ entry.cpEditUrl }}">{{ owner.title ?: entry.type.name }}</a>
                                {% else %}
                                    <a href="{{ entry.cpEditUrl }}">{{ entry.title ?: entry.type.name }} INVALID
                                        OWNER {{ entry.ownerId }}</a>
                                {% endif %}
                            </div>
                        {% endfor %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}

    {% endfor %}
</table>